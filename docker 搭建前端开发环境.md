背景：在新的设备安装一个开发环境通常是一个繁琐的过程，而且各个系统的机器有各种各样的差异（系统，版本），可能会出现各种不同的问题。使用容器能最快速搭建开发环境，减少机器之间差异，快速切换环境依赖项等等。  
优点：搭建环境简单，按配置即可；与物理机隔离，升级便捷。

思考：基于容器也可以做很多其它事情，如灰度发布，自动化部署，不中断服务，所以有必要对容器相关知识做些了解，可以通过搭建一个开发环境去熟悉。

1.新建文件 `Dockerfile`

|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `# 基于linux debian:buster 搭建基础镜像`<br><br>`FROM debian:buster`<br><br>`# 换国内源`<br><br>`RUN` `sed` `-i` `'s\|[http://deb.debian.org/debian](http://deb.debian.org/debian)\|[http://mirrors.aliyun.com/debian](http://mirrors.aliyun.com/debian)\|g'` `/etc/apt/sources``.list && \`<br><br>    `sed` `-i` `'s\|[http://deb.debian.org/debian](http://deb.debian.org/debian)\|[http://mirrors.tuna.tsinghua.edu.cn/debian](http://mirrors.tuna.tsinghua.edu.cn/debian)\|g'` `/etc/apt/sources``.list && \`<br><br>    `sed` `-i` `'s\|[http://deb.debian.org/debian](http://deb.debian.org/debian)\|[http://mirrors.163.com/debian](http://mirrors.163.com/debian)\|g'` `/etc/apt/sources``.list && \`<br><br>    `sed` `-i` `'s\|[http://deb.debian.org/debian](http://deb.debian.org/debian)\|[http://mirrors.ustc.edu.cn/debian](http://mirrors.ustc.edu.cn/debian)\|g'` `/etc/apt/sources``.list`<br><br>`# 更新软件包列表和安装基本工具`<br><br>`RUN apt-get update && apt-get` `install` `-y ca-certificates curl gnupg2 software-properties-common apt-transport-https vim git`<br><br>`# 添加 NodeSource 仓库`<br><br>`RUN curl -sL https:``//deb``.nodesource.com``/setup_16``.x \|` `bash` `-`<br><br>`# 安装 Node.js 16.x`<br><br>`RUN apt-get` `install` `-y nodejs`<br><br>`# 安装 NVM`<br><br>`RUN curl -o- https:``//raw``.githubusercontent.com``/nvm-sh/nvm/v0``.39.1``/install``.sh \|` `bash`<br><br>`# 安装 yarn`<br><br>`RUN npm` `install` `-g yarn`<br><br>`# 设置 npm kjl 源`<br><br>`RUN npm config` `set` `registry http:``//npm-registry``.qunhequnhe.com/`<br><br>`# 安装 def`<br><br>`RUN npm i @qunhe``/def-next-cli` `-g`<br><br>`# 容器内打开浏览器依赖 xdg-utils`<br><br>`RUN apt-get` `install` `-y xdg-utils`<br><br>`# 设置工作目录`<br><br>`WORKDIR` `/codes`<br><br>`# 添加 FNM 到 PATH`<br><br>`# RUN source ~/.nvm/nvm.sh`<br><br>`# 将宿主机的代码目录挂载到容器中`<br><br>`VOLUME [``"/codes"``]`<br><br>`# 暴露端口`<br><br>`EXPOSE 7000`<br><br>`# 启动命令`<br><br>`CMD [``"bash"``]` |

2.基于 Dockerfile 构建镜像

|                                 |
| ------------------------------- |
| `docker build -t fed-``env` `.` |

3.运行docker容器

|                                                                                                                                                                 |
| --------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `# -v <宿主机目录>:<容器目录>卷，将宿主机的目录挂载到容器中`<br><br>`# -p 暴露端口 -p <宿主机端口>:<容器端口>`<br><br>`docker run -it --name fed -``v` `/d/apps``:``/codes` `-p 7000:7000 fed-``env` |